# This file is part of vscode-bait.
# The content is subject to the terms of the MIT license.
# Copyright (c) 2022-present Lukas Neubert.

scopeName: source.bait
fileTypes: [.bt]

patterns:
  - include: '#comments'
  - include: '#types'
  - include: '#functions'
  - include: '#keywords'
  - include: '#numbers'
  - include: '#strings'
  - include: '#variables'

repository:
  comments:
    patterns:
      - name: comment.line.double-slash
        begin: //
        end: $
      - name: comment.block
        begin: /\*
        beginCaptures:
          0:
            name: meta.comment.block.begin
        end: \*/
        endCaptures:
          0:
            name: meta.comment.block.end
        patterns:
          - include: "#comments"

  functions:
    patterns:
      - name: meta.function.definition
        begin: ^(?:(pub\b)\s+)?(fun\b)\s*(?:\((\w+)\W+([a-zA-Z0-9.]+)\))?
        beginCaptures:
          1:
            name: keyword.other
          2:
            name: keyword.fun
          3:
            name: variable.parameter
          4:
            name: support.type.receiver
        end: (\w+)\s*\(
        endCaptures:
          1:
            name: entity.name.function
      - name: meta.function.call
        match: (\w+)\(
        captures:
          1:
            name: entity.name.function

  keywords:
    patterns:
      - name: keyword.fun
        match: \bfun\b
      - name: keyword.other
        match: \b(as|assert|const|enum|global|import|mut|package|pub|struct|type|typeof)\b
      - name: keyword.control
        match: \b(and|break|continue|else|for|if|in|is|match|not|or|return)\b
      - name: constant.language
        match: \b(false|true)\b

  numbers:
    name: constant.numeric
    match: -?\d+

  strings:
    patterns:
      - name: string.quoted.single
        begin: "'"
        end: "'"
        patterns:
          - include: '#string-escaped-char'
          - include: '#string-interpolation'
      - name: string.quoted.double
        begin: "\""
        end: "\""
        patterns:
          - include: '#string-escaped-char'
          - include: '#string-interpolation'
      - name: string.other.byte
        begin: "`"
        end: "`"
        patterns:
          - include: '#char-escaped-char'

  string-escaped-char:
    name: constant.character.escape.bait
    match: \\[\'\"\\]

  char-escaped-char:
    name: constant.character.escape.bait
    match: \\[`\\]

  string-interpolation:
    name: meta.string.interpolated
    match: (\${)([^}]*)(})
    captures:
      1:
        name: punctuation.definition.template-expression.begin
      2:
        name: variable.other.interpolated
      3:
        name: punctuation.definition.template-expression.end

  types:
    name: support.type.builtin
    match: \b(bool|(i|u)(8|16|32|64)|f(32|64)|map|string)\b

  variables:
    name: variable.other
    match: \b[a-z][a-z0-9_]*\b
